{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block content %}

<h2>{{recipe.title}}</h2>

{% if request.user.is_authenticated %}
  <p>
    {% if request.user != recipe.author %}
      <a href="/recipe_review"> Review Recipe </a> |
    {% endif %}
    {% if recipe in request.user.favorites.all %}
      <a href="/unfavorite/{{ recipe.title }}">Unfavorite This Recipe</a>
    {% else %}
      <a href="/favorite/{{ recipe.title }}">Favorite This Recipe</a>
    {% endif %}
    {% if request.user == recipe.author %}
      | <a href="/recipe_edit"> Edit Recipe </a>
    {% endif %}
    | <a href="/recipe_nutrition"> Nutrition Info </a>
  </p>
{% endif %}

<p>
  Rating: 5 Stars | Favorited by {{ recipe.favorited_by.count }} users
<p>

<ul>
  <li>
    Author:
    <a href="/profile/{{ recipe.author.username }}"
      >{{recipe.author.username}}</a
    >
    | Created on {{recipe.date_created}}
  </li>
  <li>
    Tags:
    <ul>
      {% for tag in recipe.tags %}
      <li>
        {{tag}}
      </li>
      {% endfor %}
    </ul>
  </li>
  <li>
    Description: {{recipe.description}}
  </li>
  <li>
    # of servings: {{recipe.servings}}
  </li>
  <li>
    <!-- will set up custom tag to make this easier -->
    <!-- Prep Time:  recipe|related_plain_time recipe.time_prep  -->
    Prep Time: {{recipe.time_prep}}
  </li>
  <li>
    <!-- will set up custom tag to make this easier -->
    <!-- Prep Time:  recipe|related_plain_time recipe.time_prep  -->
    Cook Time: {{recipe.time_cook}}
  </li>
  <li>
    <!-- will set up custom tag to make this easier -->
    <!-- Prep Time:  recipe|related_plain_time recipe.time_prep  -->
    Additional Time: {{recipe.time_additional}}
  </li>
  <!-- Total Time -->
  <li>
    Ingredients:
    <ul>
      {% for ingredient in recipe.ingredients %}
      <li>
        {{ingredient}}
      </li>
      {% endfor %}
    </ul>
  </li>
  <li>
    Instructions:
    <ul>
      {% for step in recipe.instructions %}
      <li>
        {{step}}
      </li>
      {% endfor %}
    </ul>
  </li>
</ul>

<div>
    <h4>Write a Review</h4>
    <form action="" method="post">
        {% csrf_token %}
        {{ form|crispy }}
        <input type="submit" class="btn btn-primary" value="Submit" />
    </form>
</div>

<div>
    {% for review in reviews %}
        <div>
            <ul>
                <li>
                    {{review.title}} | {{review.author}} | {{review.rating}}
                </li>
                <li>
                    {{review.content}}
                </li>
                <li>
                    <a>Upvote: {{review.upvotes}}</a> | <a>Downvote: {{review.downvotes}}</a>
                </li>
            </ul>
        </div>
    {% endfor %}
</div>

{% endblock %}
